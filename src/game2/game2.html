<!DOCTYPE html>
<html lang="uk">

 <head>
  <title>Game 2</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="game2.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&family=Unica+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Play&display=swap" rel="stylesheet">
 </head>
 
 <body>

  <div id="top">
    <div id="logo">LingvoLab</div>
    <div id="page">1/67</div>
  </div>

  <div id="middle1">
    <div id="greenCircle">
      <img id="audioImage" src="../Images/tools/audio.png"/>
    </div>
  </div>

  <div id="middle2">
      <div id="buttonsRow1">      
        <div class="button1" id="button1">word1</div>
        <div class="button3" id="button3">word3</div>
      </div>

      <div id="buttonsRow2">      
        <div class="button2" id="button2">word2</div>
        <div class="button4" id="button4">word4</div>
      </div>
  </div>

    <div id="bottom">
    <div><img id="backImage" title="back to main page" onclick="document.location='../introPages/main page/main.html'" src="../Images/tools/back.png"/></div>
    <div><img id="nextImage" title="go to the next word" src="../Images/tools/next.png"/></div>
  </div>

 <script type="module">

     import User from "../User.js";
     const words = ["дорослий", "відповідь", "м'яч", "ванна", "камера"];

     const answers = [["чоловік","людина","малеча","дорослий"],
         ["відповідь","запитання","життя","м'яч"],
         ["гра","м'яч","камера","дорослий"],
         ["спальня","туалет","ванна","дитина"],
         ["людина","м'яч","камера","телевізор"]];
     //array with sounds
     const sounds = ['../Music/game1/A1/Adult.mp3','../Music/game1/A1/Answer.mp3','../Music/game1/A1/Ball.mp3','../Music/game1/A1/Bathroom.mp3','../Music/game1/A1/Camera.mp3']

     const name = localStorage.getItem("last");

     const currentUser = User.build(localStorage.getItem(name));

     //set first world
     firstWord();

     function firstWord(){
          if (currentUser.getProgressGame2().length===0){
             document.getElementById('greenCircle').remove();
             document.getElementById('middle2').remove();
             document.getElementById('nextImage').remove();
             document.getElementById('page').remove();

             let newBox = document.createElement("div");
             newBox.id = "newBox";

             document.getElementById('middle1').appendChild(newBox);
             document.getElementById('newBox').textContent = "Ви молодціytre! \n Ваш результат : " + (sounds.length - currentUser.getProgressGame2().length) + "/" + sounds.length;

         }
         else if(currentUser.getProgressGame2()[0].length<1) {
             currentUser.setProgressGame2(sounds);
             console.log("after reload" + currentUser);
             localStorage.setItem(name,currentUser.toString());
         }
     }



     let progress = currentUser.getProgressGame2();

     document.getElementById("page").textContent = ((currentUser.getIndexAtGame2()+1) + "/" + sounds.length).toString();

     //text

     document.getElementById('button1').textContent=answers[currentUser.indexAtGame2][0].toString();
     document.getElementById('button2').textContent=answers[currentUser.indexAtGame2][1].toString();
     document.getElementById('button3').textContent=answers[currentUser.indexAtGame2][2].toString();
     document.getElementById('button4').textContent=answers[currentUser.indexAtGame2][3].toString();

     //add event listener
     document.getElementById('nextImage').addEventListener("click",change);

     document.getElementById('audioImage').addEventListener("click",sound);

     document.getElementById('button1').addEventListener("click",btn1);
     document.getElementById('button2').addEventListener("click",btn2);
     document.getElementById('button3').addEventListener("click",btn3);
     document.getElementById('button4').addEventListener("click",btn4);

     function sound() {
         var audio = new Audio(); // Создаём новый элемент Audio
         console.log(currentUser);
         console.log(sounds);
         console.log(sounds.length);
         audio.src = sounds[currentUser.getIndexAtGame2()]; // Указываем путь к звуку "клика"
         audio.play()// Автоматически запускаем


         console.log("after sounds" + currentUser);
         console.log("after sounds" +sounds);
         console.log("after sounds" +sounds.length);
     }

     let choosenVariant="";

     function change(){

         let index = currentUser.getIndexAtGame2();
         const src = sounds[index];


         if(choosenVariant.length>0){

             if(choosenVariant===words[currentUser.indexAtGame2]){
                 const getProgressIndex = progress.indexOf(src);
                 let newArray = [];
                 for (let i = 0; i < progress.length; i++) {
                     if(i!==getProgressIndex){
                         newArray.push(progress[i]);
                     }
                 }

                 console.log(newArray);
                 progress = [];
                 console.log(progress)
                 progress = newArray;
                 currentUser.setProgressGame2(progress);
                 localStorage.setItem(name,currentUser.toString());
             }

             index++;
             console.log(index);
             currentUser.setIndexAtGame2(index);
             //check if end

             if(currentUser.getIndexAtGame2()===sounds.length){
              /*   document.getElementById('greenCircle').remove();
                 document.getElementById('middle2').remove();
                 document.getElementById('nextImage').remove();
                 document.getElementById('page').remove();

                 let newBox = document.createElement("div");
                 newBox.id = "newBox";

                 document.getElementById('middle1').appendChild(newBox);
                 document.getElementById('newBox').textContent = "Ви молодціliza! \n Ваш результат : " + (sounds.length - currentUser.getProgressGame2().length) + "/" + sounds.length;
*/
                 currentUser.setIndexAtGame2(0);
                 if(currentUser.getProgressGame2().length===0){
                     currentUser.setIndexAtGame2([]);
                 }
                 else {
                     currentUser.setProgressGame2([""]);
                 }
                 localStorage.setItem(name, currentUser.toString());
                 document.location.replace("../introPages/main page/main.html");
             }
             else {
                 setButtons();
                 localStorage.setItem(name, currentUser.toString());
                 document.getElementById("page").textContent = ((currentUser.getIndexAtGame2() + 1) + "/" + sounds.length).toString();
             }
         }
         else {
             alert("Будь-ласка, виберіть переклад прослуханого слова! ")
         }

     }


     function btn1(){
         choosenVariant = document.getElementById('button1').textContent.toString();
         console.log(choosenVariant);
         document.getElementById('button1').classList.remove("button1");
         document.getElementById('button1').style="background-color: #DEEFED";

         document.getElementById('button2').removeEventListener("click",btn2);
         document.getElementById('button3').removeEventListener("click",btn3);
         document.getElementById('button4').removeEventListener("click",btn4);

         document.getElementById('button2').classList.remove("button2");
         document.getElementById('button3').classList.remove("button3");
         document.getElementById('button4').classList.remove("button4");

         document.getElementById('button2').classList.add("buttonDisable");
         document.getElementById('button3').classList.add("buttonDisable");
         document.getElementById('button4').classList.add("buttonDisable");


     }


     function btn2(){
         choosenVariant = document.getElementById('button2').textContent.toString();
         console.log(choosenVariant);
         document.getElementById('button2').classList.remove("button2");
         document.getElementById('button2').style="background-color: #DEEFED";

         document.getElementById('button1').removeEventListener("click",btn1);
         document.getElementById('button3').removeEventListener("click",btn3);
         document.getElementById('button4').removeEventListener("click",btn4);

         document.getElementById('button1').classList.remove("button1");
         document.getElementById('button3').classList.remove("button3");
         document.getElementById('button4').classList.remove("button4");

         document.getElementById('button1').classList.add("buttonDisable");
         document.getElementById('button3').classList.add("buttonDisable");
         document.getElementById('button4').classList.add("buttonDisable");
     }

     function btn3(){
         choosenVariant = document.getElementById('button3').textContent.toString();
         console.log(choosenVariant);
         document.getElementById('button3').classList.remove("button3");
         document.getElementById('button3').style="background-color: #DEEFED";

         document.getElementById('button2').removeEventListener("click",btn2);
         document.getElementById('button1').removeEventListener("click",btn1);
         document.getElementById('button4').removeEventListener("click",btn4);

         document.getElementById('button2').classList.remove("button2");
         document.getElementById('button1').classList.remove("button1");
         document.getElementById('button4').classList.remove("button4");

         document.getElementById('button2').classList.add("buttonDisable");
         document.getElementById('button1').classList.add("buttonDisable");
         document.getElementById('button4').classList.add("buttonDisable");
     }

     function btn4(){
         choosenVariant = document.getElementById('button4').textContent.toString();
         console.log(choosenVariant);
         document.getElementById('button4').classList.remove("button4");
         document.getElementById('button4').style="background-color: #DEEFED";

         document.getElementById('button2').removeEventListener("click",btn2);
         document.getElementById('button3').removeEventListener("click",btn3);
         document.getElementById('button1').removeEventListener("click",btn1);

         document.getElementById('button2').classList.remove("button2");
         document.getElementById('button3').classList.remove("button3");
         document.getElementById('button1').classList.remove("button1");

         document.getElementById('button2').classList.add("buttonDisable");
         document.getElementById('button3').classList.add("buttonDisable");
         document.getElementById('button1').classList.add("buttonDisable");
     }

     function setButtons(){
         document.getElementById('button1').classList.add("button1");
         document.getElementById('button2').classList.add("button2");
         document.getElementById('button3').classList.add("button3");
         document.getElementById('button4').classList.add("button4");

         document.getElementById('button1').style.removeProperty("background-color");
         document.getElementById('button2').style.removeProperty("background-color");
         document.getElementById('button3').style.removeProperty("background-color");
         document.getElementById('button4').style.removeProperty("background-color");

         document.getElementById('button1').classList.remove("buttonDisable");
         document.getElementById('button2').classList.remove("buttonDisable");
         document.getElementById('button3').classList.remove("buttonDisable");
         document.getElementById('button4').classList.remove("buttonDisable");

         document.getElementById('button1').addEventListener("click",btn1);
         document.getElementById('button2').addEventListener("click",btn2);
         document.getElementById('button3').addEventListener("click",btn3);
         document.getElementById('button4').addEventListener("click",btn4);

         document.getElementById('button1').textContent=answers[currentUser.indexAtGame2][0].toString();
         document.getElementById('button2').textContent=answers[currentUser.indexAtGame2][1].toString();
         document.getElementById('button3').textContent=answers[currentUser.indexAtGame2][2].toString();
         document.getElementById('button4').textContent=answers[currentUser.indexAtGame2][3].toString();
     }


 </script>

 </body>

</html>