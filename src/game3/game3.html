<!--
@file: game3.html
@authors: Huza Mariia-Valeriia, Andriienko Yelyzaveta, Shevchenko Daria

A file of a page with instructions for the user
-->
<!DOCTYPE html>
<html lang="uk">

 <head>
  <title>Game 3</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="game3.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500&family=Unica+One&display=swap" rel="stylesheet">
 </head>
 
 <body>

  <div id="top">
    <div id="logo">LingvoLab</div>
    <div id="page">1/67</div>
  </div>

  <div id="middle">
    <div id="greenRectangle">
      <img id="appleImage">
      
      <div id="group">      
          <input id="inputText" type="text" required>
          <span id="highlight"></span>
          <span id="bar"></span>
          <label>It`s a(-n)...</label>
      </div>

    </div>
  </div>

	<div id="bottom">
    <div><img id="backImage" title="back to main page" onclick="document.location='../introPages/main page/main.html'" src="../Images/tools/back.png"/></div>
    <div><img id="nextImage" title="go to the next image" src="../Images/tools/next.png"/></div>
  </div>

 <script type="module">

     import User from "../User.js";

     const words = ["apple","banana","boy","cake","cat"]
     const images = ["../Images/game3/A1/apple.png","../Images/game3/A1/banana.png","../Images/game3/A1/boy.png","../Images/game3/A1/cake.png","../Images/game3/A1/cat.png"]

     const name = localStorage.getItem("last");

     const currentUser = User.build(localStorage.getItem(name));

     //set first world
     firstWord();

     function firstWord(){
         if(currentUser.getProgressGame3().length===0){
             document.getElementById('group').remove();
             document.getElementById('greenRectangle').remove();
             document.getElementById('nextImage').remove();
             document.getElementById('page').remove();

             let newBox = document.createElement("div");
             newBox.id = "newBox";

             document.getElementById('middle').appendChild(newBox);
             document.getElementById('newBox').textContent = "Ви молодці! \n Ваш результат : " + (words.length - currentUser.getProgressGame3().length) + "/" + words.length;

         }
        else if(currentUser.getProgressGame3()[0].length<1) {
             currentUser.setProgressGame3(images);
             console.log("after reload" + currentUser);
             localStorage.setItem(name,currentUser.toString());
         }
     }



     let progress = currentUser.getProgressGame3();
     //??????
     document.getElementById("appleImage").src=images[currentUser.indexAtGame3];
     document.getElementById("page").textContent = ((currentUser.getIndexAtGame3()+1) + "/" + images.length).toString();


     //add event listener
     document.getElementById('nextImage').addEventListener("click",check);

     function check(){
         const input = document.getElementById("inputText").value.toLowerCase();
         document.getElementById("inputText").value = "";
         const src = document.getElementById("appleImage").getAttribute('src');

         let index = images.indexOf(src);
         console.log("input - " + input);
         console.log("src - " + src);
         console.log("index - " + index);


         if(input.toString() === words[index]){

             const getProgressIndex = progress.indexOf(src);

             let newArray = [];
             for (let i = 0; i < progress.length; i++) {
                 if(i!==getProgressIndex){
                     newArray.push(progress[i]);
                 }
             }
             console.log(newArray);
             progress = [];
             console.log(progress)
             progress = newArray;

             currentUser.setProgressGame3(progress);

         }
         index++;
         currentUser.setIndexAtGame3(index);

         if(currentUser.getIndexAtGame3()===words.length){
             document.getElementById('group').remove();
             document.getElementById('greenRectangle').remove();
             document.getElementById('nextImage').remove();
             document.getElementById('page').remove();

             let newBox = document.createElement("div");
             newBox.id = "newBox";

             document.getElementById('middle').appendChild(newBox);
             document.getElementById('newBox').textContent = "Ви молодці! \n Ваш результат : " + (words.length - currentUser.getProgressGame3().length) + "/" + words.length;

             currentUser.setIndexAtGame3(0);
             if(currentUser.getProgressGame3().length===0){
                 currentUser.setIndexAtGame3([]);
             }
             else {
                 currentUser.setProgressGame3([""]);
             }
             localStorage.setItem(name, currentUser.toString());
         }
        else {
             document.getElementById("appleImage").src = images[index];
             localStorage.setItem(name, currentUser.toString());
             document.getElementById("page").textContent = ((currentUser.getIndexAtGame3() + 1) + "/" + images.length).toString();
         }

     }



 </script>

 </body>

</html>